# HG changeset patch
# Parent 0d99029db8d5101dac2608165dda74ca2539ab1f

diff -r 0d99029db8d5 tools/libxc/xc_domain_restore.c
--- a/tools/libxc/xc_domain_restore.c
+++ b/tools/libxc/xc_domain_restore.c
@@ -98,8 +98,8 @@ static ssize_t rdexact(xc_interface *xch
         if ( (len == -1) && ((errno == EINTR) || (errno == EAGAIN)) )
             continue;
         if ( len == 0 ) {
-            ERROR("0-length read");
-            errno = 0;
+            errno = EPIPE;
+            return -1;
         }
         if ( len <= 0 ) {
             ERROR("%s failed (read rc: %d, errno: %d)", __func__, len, errno);
@@ -1654,7 +1654,7 @@ int xc_domain_restore(xc_interface *xch,
             pagebuf.nr_physpages = pagebuf.nr_pages = 0;
             pagebuf.compbuf_pos = pagebuf.compbuf_size = 0;
             if ( pagebuf_get_one(xch, ctx, &pagebuf, io_fd, dom) < 0 ) {
-                PERROR("Error when reading batch");
+	        /* pagebuf_get_one already returned a proper error */
                 goto out;
             }
         }
