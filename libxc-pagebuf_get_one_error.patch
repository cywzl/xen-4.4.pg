# HG changeset patch
# Parent 46e666af2f882b5aa5fd4ad75af32c06d66848ef

diff -r 46e666af2f88 tools/libxc/xc_domain_restore.c
--- a/tools/libxc/xc_domain_restore.c
+++ b/tools/libxc/xc_domain_restore.c
@@ -1376,7 +1376,7 @@ int xc_domain_restore(xc_interface *xch,
         if ( !ctx->completed ) {
             pagebuf.nr_physpages = pagebuf.nr_pages = 0;
             pagebuf.compbuf_pos = pagebuf.compbuf_size = 0;
-            if ( pagebuf_get_one(xch, ctx, &pagebuf, io_fd, dom) < 0 ) {
+            if ( ( rc = pagebuf_get_one(xch, ctx, &pagebuf, io_fd, dom) ) < 0 ) {
 	        /* pagebuf_get_one already returned a proper error */
                 goto out;
             }
@@ -1534,16 +1534,16 @@ int xc_domain_restore(xc_interface *xch,
 
     // DPRINTF("Buffered checkpoint\n");
 
-    if ( pagebuf_get(xch, ctx, &pagebuf, io_fd, dom) ) {
+    if ( ( rc = pagebuf_get(xch, ctx, &pagebuf, io_fd, dom) ) ) {
         PERROR("error when buffering batch, finishing");
-        goto finish;
+        goto out;
     }
     memset(&tmptail, 0, sizeof(tmptail));
     tmptail.ishvm = hvm;
-    if ( buffer_tail(xch, ctx, &tmptail, io_fd, max_vcpu_id, vcpumap,
-                     ext_vcpucontext, vcpuextstate, vcpuextstate_size) < 0 ) {
+    if ( ( rc = buffer_tail(xch, ctx, &tmptail, io_fd, max_vcpu_id, vcpumap,
+                            ext_vcpucontext, vcpuextstate, vcpuextstate_size) ) < 0 ) {
         ERROR ("error buffering image tail, finishing");
-        goto finish;
+        goto out;
     }
     tailbuf_free(&tailbuf);
     memcpy(&tailbuf, &tmptail, sizeof(tailbuf));
