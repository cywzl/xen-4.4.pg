#
# XenServer patch queue on top of xen-4.3-testing.hg
#    Upstream at http://http://xenbits.xen.org/hg/xen-4.3-testing.hg/
#
# In an effort to reduce future work of upgrading Xen versions, all patches in
# this queue require a justification as to why they can't/won't be upstreamed,
# with the implication that everything else should be upstreamed.
#
# If in any doubt, the ring0 patch queue maintainer will be happy to help.
#
# All patches should follow the guidelines listed here:
#       http://wiki.xen.org/wiki/Submitting_Xen_Patches
# in particular with respect to a description and S-o-b lines, with the
# exception of temporary debugging patches, which should contain at least a CA
# reference.
#
# Overview of sections:
# * XenServer build system integration.
#       **Minimal Upstream makefile hacks**
# * Upstream patches.
#       Verbatim patches from upstream, possibly with tweaks because of backporting
#       Typically from xen-{4.3,unstable}.hg
# * Patches which are upstream but hard to backport.
#       Only if upstream has diverged enough.  Hopefully empty
# * Patches for upstream.
#       Most patches should be in this section, especially new ones.  By using
#       this section, you are assuming responsibility for getting the patches
#       included upstream, and will be periodically chased by the patch queue
#       maintainer.
# * Un-upstreamable patches.
#       CC-mode restrictions etc.  Should be minimal.
# * Technical debt.
#       Legacy patches brought forward from the past.  This section should
#       never increase, and should progressively decrease.  **Remove when empty**
# * Debugging patches.
#       Temporary debugging patches, which must contain a CA reference.  Before
#       closing a ticket, you are expected to remove debugging patches.

revert-xen-3.4-18560.782599274bf9-ported.patch # This needs to be removed in a migrate-safe way

################################################################################
# XenServer build system integration
#
modify-xen-version.patch # Deliberately to conflict if upstream retags
builder-makefiles.patch # XS Makefile and Spec file
configure-build.patch # Configuration files for the build, including cached ./configure

# build-disable-toplevel.patch # HACK
# build-prune-system-integration.patch # HACK
# build-prune-installed-binaries.patch # HACK
# build-prune-python.patch # HACK
# xs-compat.patch
# assert-printk.patch

################################################################################
# Upstream patches
#
# Naming scheme as "xen-<version>.hg-<rev>.<hash>[-ported].patch"
#     <version>   typically unstable
#     <rev>       patch revision
#     <hash>      patch short hash
#     [-ported]   indicates that the patch has had to be ported to apply
#

# Patches from xen-4.3-testing.hg

# Patches from xen-unstable.hg
# xen-unstable.hg-25898.6ba5dd841439.patch # xl: do not leak cpupool names.
# xen-unstable.hg-25932.06a0774df47c.patch # ACPI: move tables.c fully into .init.*
# xen-unstable.hg-26274.ef8c1b607b10-ported.patch # set_ist() to save open coding bitwise operations.
# xen-unstable.hg-26282.f50aab21f9f2-ported.patch # kexec fix NMI and MCE handling.
# xen-unstable.hg-26374.c3c683a439ae.patch # tools/ocaml: libxc bindings: Correct PCI terminology
# xen-unstable.hg-26381.e6f74afc78d2-ported.patch # x86: Assert !in_atomic() before exiting to guest context.
# xen-unstable.hg-26383.21a2ecc73183-ported.patch # xen: Introduce ASSERT_NOT_IN_ATOMIC() to give more info on in_atomic() crash.
# xen-unstable.hg-26404.76598d4bf61e.patch # x86: handle both NMI kinds if they occur simultaneously
# xen-unstable.hg-26524.171018fef8f8.patch # x86/HAP: Add global enable/disable command line option
# xen-unstable.hg-26535.7af3c38ae187-ported.patch # hvm: Allow triple fault to imply crash rather than reboot
# xen-unstable.hg-26594.9e1cb186a077.patch # x86/mm: avoid locked lookups in shadow emulation.
# xen-unstable.hg-26790.07b3d8693115.patch # x86: show handler for Xen-internal interrupts.


################################################################################
# Patches which are upstream but hard to backport
#

################################################################################
# Patches for upstream
#
# dom0_max_vcpus.patch # dvrabel
#parallel-bootscrub.patch # malcolmc - patch is currently broken
# add-ivy-bridge-EP-EN-EX-cpu-to-cpuid-masking.patch
# 0001-trace-allow-for-different-sub-classes-of-TRC_PV_-tra.patch # dvrabel
# 0002-trace-improve-usefulness-of-hypercall-trace-record.patch # dvrabel
# 0003-trace-trace-hypercalls-inside-a-multicall.patch # dvrabel
# xenstored-syslog.patch # djs
# xenstored-syslog2.patch # djs
# xenstored-syslog3.patch # djs
# xenstored-syslog4.patch # djs
# detect-nehalem-c-state.patch # malcolmc
# add-clflush-before-monitor-intel-7400-series.patch # malcolmc

# sysctl-conring-size-ported.patch # andrewcoop
# libxc-consoleringsize.patch # andrewcoop
# libxc-readconsolering-hypercallbuffer.patch # andrewcoop
# ocaml-xc-stubs-fix-readconsolering.patch # andrewcoop
# ocaml-xc-stubs-fix-failwith_xc.patch # andrewcoop

# fix-ocaml-libs.patch

# dvrabel - already submitted upstream
# domain-page-64bit.patch
# 0001-x86-give-FIX_EFI_MPF-its-own-fixmap-entry.patch
# 0002-xen-make-GUEST_HANDLE_64-and-uint64_aligned_t-availa.patch
# 0003-kexec-add-public-interface-for-improved-load-unload-.patch
# 0004-kexec-add-infrastructure-for-handling-kexec-images.patch
# 0005-kexec-extend-hypercall-with-improved-load-unload-ops.patch
# 0006-xen-kexec-crash-image-when-dom0-crashes.patch
# 0007-libxc-add-hypercall-buffer-arrays.patch
# 0008-libxc-add-API-for-kexec-hypercall.patch
# 0009-x86-check-kexec-relocation-code-fits-in-a-page.patch
# kexec_load_slot-avoid-double-free.patch

# migration-memory-leaks.patch # andrewcoop - already submitted
# time-always-update-wallclock.patch # andrewcoop - already submitted

################################################################################
# Un-upstreamable patches
#
# xen-tweak-cmdline-defaults.patch
# cc-restrictions.patch
# cc-decrease-reservation.patch
# tweak-iommu-errata-policy.patch

################################################################################
# Technical debt
#
#add-acpi-cstate-reporting-to-xenpm.patch # malcolmc - doesn't apply

# xen-legacy-win-driver-version.patch
# xen-legacy-win-xenmapspace-quirks.patch
# xen-legacy-32bit_shinfo.patch

# xen debt
# xen-dont-hide-vtx-or-svm.patch # for xenrt.  Very unsafe :(
# xen-define-offsets-for-kdump.patch
# xen-scheduler-auto-privdom-weight.patch
# xen-memcpy-nt.patch # non-temporal memcpy, for gntcpy
# xen-lowmem-emergency-pool.patch # argument appears wrong ?
# xen-dont-emulate-movnti.patch
# xen-hvm-disable-tsc-ramping.patch
# xen-hvm-hpet-extra-50us.patch
# xen-hvm-op-process-dying.patch
# xen-npt-detect-barcelona.patch
# xen-stubdom-privileged-domctls.patch
# xen-hvm-hide-nx.patch
# xen-viridian-extra-hypercalls.patch
# xen-hvm-disable-console-params.patch
# xen-quieten-cpuid-masking-error.patch # Only needed because Xapi doesn't understand cpuid_mask_xsave_eax
# xen-quieten-cstate-warning.patch
# xen-stack-pointer-position.patch
# xen-capture-boot-cpuid-info.patch
# xen-apply-cpuid-mask-to-cpuid-faulting.patch
# xen-hvm-bufioreq-eventchannel.patch

# libxc debt
# libxc-uclibc-threading.patch # for uclibc - do we need this any more?
# libxc-uclibc-fadvise.patch # for uclibc - no posix_fadvise
# libxc-native-protocol-accessor.patch # for xapi - apparently needed until based on libxl
# libxc-ioctl-restrict.patch # for privelege restriction
# libxc-ext-5.patch
# libxc-ext-6.patch
# libxc-ext-7.patch
# libxc-ext-8.patch
# libxc-drop-min-loglevel.patch
# libxc-revert-qemu-tail.patch
# libxc-domain-resume-one-checkpoint.patch
# libxc-use-default-cpuid-policies.patch
# libxc-empty-pipe.patch

# libxl debt
# libxl-default-config.patch # This is kudgy - merge into system configuration ?

# pygrub debt
# pygrub-add-default-and-extra-args.patch
# pygrub-always-boot-default.patch
# pygrub-friendly-no-fs.patch
# pygrub-blacklist-oel5.6.patch

# BIOS debt
# oem-bios-xensource.patch # Can probably all be discarded
# oem-bios-magic-from-xenstore.patch # Need to tweak, but should be upstreamed

# misc debt
# misc-xeninfo-tool.patch # Superseeded by `xl info`
# misc-crash-guest.patch # Superseeded by `xen-hvmcrash`
# misc-log-guest-consoles.patch # xenconsoled listening to xenstore.  Do we use this?

# mixed between components
# mixed-domain-runstates.patch
# mixed-xc-sockets-per-core.patch
# mixed-cpuid-before-mask.patch
# xenguest.patch

#xenstore-xenbus-only-commu.patch
# oxenstore-customize.patch
# oxenstore-update.patch
# xenctrl-improved-ocaml-namespacing.patch


################################################################################
# Debugging patches
#

# power-old.patch
# ca-96875-debug.patch # Log past 8 vmx vmexit reasons
# hvm-triple-fault-means-crash.patch
# pagebuf_get_one_error.patch
# ca-96759-hack.patch # default xsave to off (like 4.1).  Needs CP-4312 to fix Ubuntu 12.04 properly
# hvmloader-acpi-hack.patch # new hvmloader needs platform/acpi="1" rather than "true"
# ca-102905-debug-queued-invalidate-deadlock.patch
# ca-100725-global-perdev.patch
# ca-107844-debug.patch
